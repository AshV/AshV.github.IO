<!DOCTYPE html>
<html lang="en">

<head>
    
    
    
    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    
    <title>Querying N:N Relationship Intersect Enity with FetchXML and Dynamics 365 WebAPI</title>
    
    
    












<!-- Place this data between the <head> tags of your website -->

<meta name="description" content="In a recent requirement I had to query some data from N:N relationship in client side javascript. I achieved it with fetch XML &amp;amp; WebAPI here for example I’ll be using User &amp;amp; Security Role entity." />



  <meta name="keywords" itemprop="categories" content="Dynamics-365, PowerApps" />



<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image" />



<meta name="twitter:title" content="Querying N:N Relationship Intersect Enity with FetchXML and Dynamics 365 WebAPI" />
<meta name="twitter:description" content="In a recent requirement I had to query some data from N:N relationship in client side javascript. I achieved it with fetch XML &amp;amp; WebAPI here for example I’ll be using User &amp;amp; Security Role entity." />



<!-- Twitter summary card with large image must be at least 280x150px -->

<meta name="twitter:url" content="http://localhost:4000//Query-N-N-Relationship-Intersect-Entity-FetchXML-Dynamics-365-WebAPI" />

<!-- Open Graph data -->
<meta property="og:title" content="Querying N:N Relationship Intersect Enity with FetchXML and Dynamics 365 WebAPI" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:4000//Query-N-N-Relationship-Intersect-Entity-FetchXML-Dynamics-365-WebAPI" />


<meta property="og:description" content="In a recent requirement I had to query some data from N:N relationship in client side javascript. I achieved it with fetch XML &amp;amp; WebAPI here for example I’ll be using User &amp;amp; Security Role entity." />
<meta property="og:site_name" content="Ashish Vishwakarma" />


<meta property="og:locale" content="" />


  <meta property="article:published_time" content="2018-10-21T00:00:01+05:30" />




  





  
    <meta property="article:tag" content="Dynamics-365" />
  
    <meta property="article:tag" content="PowerApps" />
  




    
    
    <link rel="canonical" href="http://localhost:4000/Query-N-N-Relationship-Intersect-Entity-FetchXML-Dynamics-365-WebAPI">
    
    
    
    <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
    
    <meta name="robots" content="noarchive">
    
    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
        <link rel="alternate" media="handheld" href=""> -->
        
        
        <link rel="stylesheet" href="http://localhost:4000/assets/css/style.css?v=">
    </head>
    <body>
        
        <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="http://localhost:4000/posts">Ashish Vishwakarma</a>
    

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="http://localhost:4000/contact.html">Contact Me</a>
              
            
          
        </div>
      </nav>
    
  </div>
</header>

        
        
        
        
        
        <section class="page-header">
            <h1 class="project-name">Querying N:N Relationship Intersect Enity with FetchXML and Dynamics 365 WebAPI</h1>
            <h2 class="project-tagline"></h2>
            
            <!-- Post tagline -->
            
            <h2 class="project-date">
                <time datetime="2018-10-21T00:00:01+05:30" itemprop="datePublished">
                    
                    Oct 21, 2018
                </time>
                
                
            </h2>
            
            <!-- End: Post tagline -->
        </section>
        
        <section class="main-content">
            
                <article itemscope itemtype="http://schema.org/BlogPosting">

        <!-- <header class="post-header">
      <h1 class="post-title" itemprop="name headline">Querying N:N Relationship Intersect Enity with FetchXML and Dynamics 365 WebAPI</h1>
      <p class="post-meta">
        <time datetime="2018-10-21T00:00:01+05:30" itemprop="datePublished">
          
          Oct 21, 2018
        </time>
        </p>
    </header> -->

        <article itemprop="articleBody">
            <p>In a recent requirement I had to query some data from N:N relationship in client side javascript. I achieved it with fetch XML &amp; WebAPI here for example I’ll be using <strong>User</strong> &amp; <strong>Security Role</strong> entity.</p>

<p>For creating N:N relationships between tables itersect tables are used which usually has 3 columns It’s own <strong>primary key</strong>, first table’s <strong>primary key</strong> &amp; second table’s <strong>primary key</strong>. In dynamics 365 GUIDs are used as primary key so each row conatins 3 GUIDs with given data.</p>

<p>To execute fetchXML, dynamics 365 webAPI requires entity’s plural name, but intersect tables don’t have that so we need to link with one of participating entity in fetchXML to query intersect entity.</p>

<blockquote>
  <p>Syntax: WebAPI Endpoint + / + Entity Plural Name + ?fetchXml= + Your fetchXml here</p>
</blockquote>

<p><a href="https://www.ashishvishwakarma.com/Execute-fetchXml-WebAPI-Dynamics-365-Using-JavaScript-Example/">Find more here about executing fetchXml with WebAPI</a></p>

<p>You need to form fetchXML like this, here entity could be either of <strong>User</strong> or <strong>Security Role</strong>, their logical names are <strong>systemuser</strong> &amp; <strong>role</strong> resplectivey. Relationship entity name can be found in N:N relationship in solutions. (refer image)</p>

<blockquote>
  <p>Syntax:</p>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;fetch&gt;</span>
   <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">"Entity Name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"Entity Logical ID"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;link-entity</span> <span class="na">name=</span><span class="s">"Relationship Entity Name"</span> <span class="na">from=</span><span class="s">"Entity ID"</span> <span class="na">to=</span><span class="s">"Entity ID"</span> <span class="na">intersect=</span><span class="s">"true"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;all-attributes</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/link-entity&gt;</span>
   <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/fetch&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>Images:Find Relationship Entity Name</p>
</blockquote>

<p><img src="assets/2018-10-21/N-N.png" alt="N:N Relationships" /></p>

<p><img src="assets/2018-10-21/Relationship.png" alt="Relationship Name" /></p>

<blockquote>
  <p>Create FetchXML</p>
</blockquote>

<p>FetchXml can be written against any of the participating entity, in this case <strong>User</strong> &amp; <strong>Security Role</strong>. It should be executed accordingly in webAPI with same entity’s plural name which is used in fetchXML. See below.</p>

<p>For <strong>Security Role</strong> =&gt; OrgURL/api/data/v9.0/<strong>roles</strong>?&lt;fetchXML&gt;…</p>

<p>For <strong>User</strong> =&gt; OrgURL/api/data/v9.0/<strong>systemusers</strong>?&lt;fetchXML&gt;…</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;fetch&gt;</span>
  <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">"role"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"roleid"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;link-entity</span> <span class="na">name=</span><span class="s">"systemuserroles"</span> <span class="na">from=</span><span class="s">"roleid"</span> <span class="na">to=</span><span class="s">"roleid"</span> <span class="na">intersect=</span><span class="s">"true"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;all-attributes/&gt;</span>
    <span class="nt">&lt;/link-entity&gt;</span>
  <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/fetch&gt;</span>
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;fetch&gt;</span>
  <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">"systemuser"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"systemuserid"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;link-entity</span> <span class="na">name=</span><span class="s">"systemuserroles"</span> <span class="na">from=</span><span class="s">"systemuserid"</span> <span class="na">to=</span><span class="s">"systemuserid"</span> <span class="na">intersect=</span><span class="s">"true"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;all-attributes/&gt;</span>
    <span class="nt">&lt;/link-entity&gt;</span>
  <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/fetch&gt;</span>
</code></pre></div></div>

<p><a href="https://www.ashishvishwakarma.com/FetchXmlTester/">Click here to use Fetch XML Tester to verify created query</a></p>

<blockquote>
  <p>Output: it would look similar</p>
</blockquote>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"@odata.context"</span><span class="p">:</span><span class="s2">"https://ashv.crm.dynamics.com/api/data/v8.2/$metadata#roles(roleid)"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"value"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nl">"@odata.etag"</span><span class="p">:</span><span class="s2">"W/</span><span class="se">\"</span><span class="s2">1003197</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"roleid"</span><span class="p">:</span><span class="s2">"e9133cb3-92e5-41c1-a242-9d17098e5f7b"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"systemuserroles1_x002e_systemuserroleid"</span><span class="p">:</span><span class="s2">"1b22830d-93c0-e811-a960-000d3af0375c"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"systemuserroles1_x002e_roleid"</span><span class="p">:</span><span class="s2">"e9133cb3-92e5-41c1-a242-9d17098e5f7b"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"systemuserroles1_x002e_systemuserid"</span><span class="p">:</span><span class="s2">"e4613b07-93c0-e811-a960-000d3af06590"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nl">"@odata.etag"</span><span class="p">:</span><span class="s2">"W/</span><span class="se">\"</span><span class="s2">1003198</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"roleid"</span><span class="p">:</span><span class="s2">"1a71447c-8751-4bf6-9800-a53faa4258f3"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"systemuserroles1_x002e_systemuserroleid"</span><span class="p">:</span><span class="s2">"bc1c140d-93c0-e811-a962-000d3af04fc2"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"systemuserroles1_x002e_roleid"</span><span class="p">:</span><span class="s2">"1a71447c-8751-4bf6-9800-a53faa4258f3"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"systemuserroles1_x002e_systemuserid"</span><span class="p">:</span><span class="s2">"e4613b07-93c0-e811-a960-000d3af06590"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Hope it helps.</p>

            <hr />
            <center><a href="https://www.buymeacoffee.com/AshV" target="_blank"><img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" alt="Buy Me A Coffee" style="height: auto !important;width: auto !important;"></a></center>
            <footer class="site-footer">
                <div id="disqus_thread"></div>
                <script>(function () { var d = document, s = d.createElement('script'); s.src = 'https://ashish-vishwakarma.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script>
                <span class="site-footer-credits">©<a href="https://www.ashishvishwakarma.com/">Ashish Vishwakarma</a>. | <a href="https://www.ashishvishwakarma.com/posts">Read More Posts</a></span>
            </footer>
        </article>
        <script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-88171590-1', 'auto'); ga('send', 'pageview');</script>
    </article>

            
            <footer class="site-footer">
                <!-- SVG icons from https://iconmonstr.com -->
                
                <!-- Github icon -->
                <span class="my-span-icon">
                    <a href="" aria-label="'s GitHub" title="'s GitHub">
                        <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    </a>
                </span>
                
                <!-- Twitter icon -->
                <span class="my-span-icon">
                    <a href="https://twitter.com/" aria-label="'s Twitter" title="'s Twitter">
                        <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
                    </a>
                </span>
                
                <!-- RSS icon -->
                
                
                <!-- Contact icon -->
                
                
                <span class="my-span-icon">
                    <a href="http://localhost:4000/contact.html" aria-label="Contact" title="Contact ">
                        <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
                    </a>
                </span>
                
                
            </footer>
        </section>
        
        <script>
            var menu = document.querySelector("nav.site-nav");
            var checkbox = document.getElementById("nav-trigger");
            
            // close menu if click outside menu
            document.addEventListener("click", function(e) {
                if (menu != e.target &&
                        !isDescendant(menu, e.target)) {
                    checkbox.checked = false;
                }
            }, false);
            
            function isDescendant(parent, child) {
                var node = child.parentNode;
                while (node != null) {
                    if (node == parent) {
                        return true;
                    }
                    node = node.parentNode;
                }
                return false;
            }  
        </script>
        
    </body>
    </html>
    
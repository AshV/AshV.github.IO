<!DOCTYPE html>
<html lang="en">

<head>
    
    
    
    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    
    <title>Create Your Own XrmToolBox Plugins </title>
    
    
    












<!-- Place this data between the <head> tags of your website -->

<meta name="description" content="XrmToolBox has plenty of useful plugins, and awesome people like you from community keep adding new plugins to solve Dynamics 365 developer’s day to day hurdles and make them more productive." />



  <meta name="keywords" itemprop="categories" content="Dynamics-365, PowerApps" />



<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image" />



<meta name="twitter:title" content="Create Your Own XrmToolBox Plugins " />
<meta name="twitter:description" content="XrmToolBox has plenty of useful plugins, and awesome people like you from community keep adding new plugins to solve Dynamics 365 developer’s day to day hurdles and make them more productive." />



<!-- Twitter summary card with large image must be at least 280x150px -->

<meta name="twitter:url" content="http://localhost:4000//Create-Your-Own-XrmToolBox-Plugins-Dynamics-365" />

<!-- Open Graph data -->
<meta property="og:title" content="Create Your Own XrmToolBox Plugins " />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:4000//Create-Your-Own-XrmToolBox-Plugins-Dynamics-365" />


<meta property="og:description" content="XrmToolBox has plenty of useful plugins, and awesome people like you from community keep adding new plugins to solve Dynamics 365 developer’s day to day hurdles and make them more productive." />
<meta property="og:site_name" content="Ashish Vishwakarma" />


<meta property="og:locale" content="" />


  <meta property="article:published_time" content="2018-06-08T00:00:01+05:30" />




  





  
    <meta property="article:tag" content="Dynamics-365" />
  
    <meta property="article:tag" content="PowerApps" />
  




    
    
    <link rel="canonical" href="http://localhost:4000/Create-Your-Own-XrmToolBox-Plugins-Dynamics-365">
    
    
    
    <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
    
    <meta name="robots" content="noarchive">
    
    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
        <link rel="alternate" media="handheld" href=""> -->
        
        
        <link rel="stylesheet" href="http://localhost:4000/assets/css/style.css?v=">
    </head>
    <body>
        
        <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="http://localhost:4000/posts">Ashish Vishwakarma</a>
    

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="http://localhost:4000/contact.html">Contact Me</a>
              
            
          
        </div>
      </nav>
    
  </div>
</header>

        
        
        
        
        
        <section class="page-header">
            <h1 class="project-name">Create Your Own XrmToolBox Plugins </h1>
            <h2 class="project-tagline"></h2>
            
            <!-- Post tagline -->
            
            <h2 class="project-date">
                <time datetime="2018-06-08T00:00:01+05:30" itemprop="datePublished">
                    
                    Jun 8, 2018
                </time>
                
                
            </h2>
            
            <!-- End: Post tagline -->
        </section>
        
        <section class="main-content">
            
                <article itemscope itemtype="http://schema.org/BlogPosting">

        <!-- <header class="post-header">
      <h1 class="post-title" itemprop="name headline">Create Your Own XrmToolBox Plugins </h1>
      <p class="post-meta">
        <time datetime="2018-06-08T00:00:01+05:30" itemprop="datePublished">
          
          Jun 8, 2018
        </time>
        </p>
    </header> -->

        <article itemprop="articleBody">
            <p><a href="https://www.xrmtoolbox.com">XrmToolBox</a> has plenty of useful plugins, and awesome people like you from community keep adding new plugins to solve Dynamics 365 developer’s day to day hurdles and make them more productive.</p>

<p>Recently I was working on a XrmToolBox plugin (have a look on GitHub <a href="https://github.com/AshV/Dynamics365BulkSolutionExporter/">Dynamics 365 Bulk Solution Exporter</a>). Let me share my learning experience with you. I would like to thank <a href="https://github.com/santoshCRM">Santosh Bhagat</a> who has already developed many solutions for the Dynamics Community, has helped me in connection related issues, and <a href="https://www.facebook.com/shabbir.WinSoft">Shabbir Hussain</a> who is young and energetic coder, has helped me in Windows Forms related stuff.
XrmToolBox is basically a class library, you can create your plugin in 2 ways.</p>

<ol>
  <li>
    <p>Start by taking a class library project and installing <a href="https://www.nuget.org/packages/XrmToolBoxPackage/">XrmToolBoxPackage</a> using nuget. You need to create one Custom Windows Form Control in this approach. I created <a href="https://github.com/AshV/Dynamics365BulkSolutionExporter/">Dynamics 365 Bulk Solution Exporter</a> this way, because template was not available back then.</p>
  </li>
  <li>
    <p>Tanguy Touzard (Creator of XrmToolBox) has simplified the process by creating <strong>XrmToolBox Plugin Project Template for Visual Studio</strong>, which configures most of the things automatically. This is preferred way of creating plugins now.</p>
  </li>
</ol>

<h3 id="start-project-with-xrmtoolbox-plugin-project-template">Start Project with XrmToolBox Plugin Project Template</h3>

<p>You won’t be getting this project template by default in Visual Studio, to install goto new project dialog, navigate to <code class="highlighter-rouge">online</code> section in left pane and search for <code class="highlighter-rouge">XrmToolBox</code> in right pane, template will appear in result. install it, Visual Studio need to be restarted in order to install the template.</p>

<p><img src="assets/2018-06-08/XrmToolBox_Project_Template.png" alt="XrmToolBox_Project_Template" /></p>

<p>After installing, create new Project using this template. Framework version should be selected as 4.6.2.</p>

<p><img src="assets/2018-06-08/New_Project.png" alt="New_Project" /></p>

<h3 id="components-of-project">Components of Project</h3>

<p>You will get 2 main files in newly created project where you need to work on.</p>

<h4 id="1-myplugincs">1. MyPlugin.cs</h4>

<p>This file contains metadata like name of the plugin, icons and color etc, which you can change according to purpose of your plugin. I am changing name of the plugin to “WhoAmI Plugin”.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.ComponentModel.Composition</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">XrmToolBox.Extensibility</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">XrmToolBox.Extensibility.Interfaces</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">XrmToolBox.WhoAmIPlugin</span>
<span class="p">{</span>
    <span class="c1">// Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class</span>
    <span class="c1">// To generate Base64 string for Images below, you can use https://www.base64-image.de/</span>
    <span class="p">[</span><span class="nf">Export</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IXrmToolBoxPlugin</span><span class="p">)),</span>
        <span class="nf">ExportMetadata</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span> <span class="s">"WhoAmI Plugin"</span><span class="p">),</span>
        <span class="nf">ExportMetadata</span><span class="p">(</span><span class="s">"Description"</span><span class="p">,</span> <span class="s">"This is a description for my first plugin"</span><span class="p">),</span>
        <span class="c1">// Please specify the base64 content of a 32x32 pixels image</span>
        <span class="nf">ExportMetadata</span><span class="p">(</span><span class="s">"SmallImageBase64"</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="c1">// Please specify the base64 content of a 80x80 pixels image</span>
        <span class="nf">ExportMetadata</span><span class="p">(</span><span class="s">"BigImageBase64"</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="nf">ExportMetadata</span><span class="p">(</span><span class="s">"BackgroundColor"</span><span class="p">,</span> <span class="s">"Lavender"</span><span class="p">),</span>
        <span class="nf">ExportMetadata</span><span class="p">(</span><span class="s">"PrimaryFontColor"</span><span class="p">,</span> <span class="s">"Black"</span><span class="p">),</span>
        <span class="nf">ExportMetadata</span><span class="p">(</span><span class="s">"SecondaryFontColor"</span><span class="p">,</span> <span class="s">"Gray"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MyPlugin</span> <span class="p">:</span> <span class="n">PluginBase</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">override</span> <span class="n">IXrmToolBoxPluginControl</span> <span class="nf">GetControl</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">MyPluginControl</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="2-settingscs">2. Settings.cs</h4>

<p>This file help you to save/update any configuration value permanently, which will be available when you next time open the tool.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">XrmToolBox.WhoAmIPlugin</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// This class can help you to store settings for your plugin</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="c1">/// &lt;remarks&gt;</span>
    <span class="c1">/// This class must be XML serializable</span>
    <span class="c1">/// &lt;/remarks&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Settings</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastUsedOrganizationWebappUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="3-myplugincontrolcs">3. MyPluginControl.cs</h4>

<p>This is a Windows Form Control which is composed of 3 files.</p>
<ol>
  <li><strong>MyPluginControl.cs[Design]</strong> : This files contains the UI where we can pull the controls from Toolbox and make the Plugin UI what user will interact with.</li>
  <li><strong>MyPluginControl.designer.cs</strong> : This files contains auto generated code, which is generated while we are placing and configuring controls in UI using drag &amp; drop. we don’t need to directly interact with this file.</li>
  <li><strong>MyPluginControl.cs</strong> : This is where we need bind our logic to different events generated from UI, like ButtonClick, OnLoad etc. This file is shown below, is contains some sample code which retrieves count of Account records and displays to user.</li>
</ol>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.ComponentModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Drawing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">XrmToolBox.Extensibility</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Xrm.Sdk.Query</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Xrm.Sdk</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">McTools.Xrm.Connection</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">XrmToolBox.WhoAmIPlugin</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MyPluginControl</span> <span class="p">:</span> <span class="n">PluginControlBase</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">Settings</span> <span class="n">mySettings</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">MyPluginControl</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">MyPluginControl_Load</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">ShowInfoNotification</span><span class="p">(</span><span class="s">"This is a notification that can lead to XrmToolBox repository"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"https://github.com/MscrmTools/XrmToolBox"</span><span class="p">));</span>

            <span class="c1">// Loads or creates the settings for the plugin</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">SettingsManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">TryLoad</span><span class="p">(</span><span class="nf">GetType</span><span class="p">(),</span> <span class="k">out</span> <span class="n">mySettings</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">mySettings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Settings</span><span class="p">();</span>

                <span class="nf">LogWarning</span><span class="p">(</span><span class="s">"Settings not found =&gt; a new settings file has been created!"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="nf">LogInfo</span><span class="p">(</span><span class="s">"Settings found and loaded"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">tsbClose_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">CloseTool</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">tsbSample_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// The ExecuteMethod method handles connecting to an</span>
            <span class="c1">// organization if XrmToolBox is not yet connected</span>
            <span class="nf">ExecuteMethod</span><span class="p">(</span><span class="n">GetAccounts</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">GetAccounts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">WorkAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">WorkAsyncInfo</span>
            <span class="p">{</span>
                <span class="n">Message</span> <span class="p">=</span> <span class="s">"Getting accounts"</span><span class="p">,</span>
                <span class="n">Work</span> <span class="p">=</span> <span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="n">args</span><span class="p">.</span><span class="n">Result</span> <span class="p">=</span> <span class="n">Service</span><span class="p">.</span><span class="nf">RetrieveMultiple</span><span class="p">(</span><span class="k">new</span> <span class="nf">QueryExpression</span><span class="p">(</span><span class="s">"account"</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">TopCount</span> <span class="p">=</span> <span class="m">50</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="n">PostWorkCallBack</span> <span class="p">=</span> <span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Error</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="s">"Error"</span><span class="p">,</span> <span class="n">MessageBoxButtons</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="n">MessageBoxIcon</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">Result</span> <span class="k">as</span> <span class="n">EntityCollection</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">$"Found </span><span class="p">{</span><span class="n">result</span><span class="p">.</span><span class="n">Entities</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="s"> accounts"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// This event occurs when the plugin is closed</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="sender"&gt;&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="e"&gt;&lt;/param&gt;</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">MyPluginControl_OnCloseTool</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Before leaving, save the settings</span>
            <span class="n">SettingsManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="nf">GetType</span><span class="p">(),</span> <span class="n">mySettings</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// This event occurs when the connection has been updated in XrmToolBox</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">UpdateConnection</span><span class="p">(</span><span class="n">IOrganizationService</span> <span class="n">newService</span><span class="p">,</span> <span class="n">ConnectionDetail</span> <span class="n">detail</span><span class="p">,</span> <span class="kt">string</span> <span class="n">actionName</span><span class="p">,</span> <span class="kt">object</span> <span class="n">parameter</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">base</span><span class="p">.</span><span class="nf">UpdateConnection</span><span class="p">(</span><span class="n">newService</span><span class="p">,</span> <span class="n">detail</span><span class="p">,</span> <span class="n">actionName</span><span class="p">,</span> <span class="n">parameter</span><span class="p">);</span>

            <span class="n">mySettings</span><span class="p">.</span><span class="n">LastUsedOrganizationWebappUrl</span> <span class="p">=</span> <span class="n">detail</span><span class="p">.</span><span class="n">WebApplicationUrl</span><span class="p">;</span>
            <span class="nf">LogInfo</span><span class="p">(</span><span class="s">"Connection has changed to: {0}"</span><span class="p">,</span> <span class="n">detail</span><span class="p">.</span><span class="n">WebApplicationUrl</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This file has few other examples too like ShowInfoNotification(), LogWarning() &amp; UpdateConnection() etc. for a complete list of available methods you can check <strong>PluginContolBase</strong> class from which this is inherited to.</p>

<h3 id="understanding-the-framework">Understanding the Framework</h3>

<p>Here in this sample we will me making WhoAmIRequest and will be showing response to user. Before that you should have a look at GetAccounts() that how it is written. We need to understand 2 main methods while getting started one is <strong>WorkAsync(WorkAsyncInfo info)</strong> and other is <strong>ExecuteMethod(Action action)</strong>.</p>

<p>In XrmToolBox plugins all requests to server should be made <strong>asynchronously</strong> but here is a twist, we won’t be using async &amp; await, instead <strong>WorkAsync(WorkAsyncInfo info)</strong> is provided in <strong>XrmToolBox.Extensibility</strong> namespace, Let’s look into <strong>WorkAsyncInfo</strong> class of framework which is main class to execute code of any plugin.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.ComponentModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">XrmToolBox.Extensibility</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WorkAsyncInfo</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">WorkAsyncInfo</span><span class="p">();</span>
        <span class="k">public</span> <span class="nf">WorkAsyncInfo</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">DoWorkEventArgs</span><span class="p">&gt;</span> <span class="n">work</span><span class="p">);</span>
        <span class="k">public</span> <span class="nf">WorkAsyncInfo</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">BackgroundWorker</span><span class="p">,</span> <span class="n">DoWorkEventArgs</span><span class="p">&gt;</span> <span class="n">work</span><span class="p">);</span>

        <span class="k">public</span> <span class="kt">object</span> <span class="n">AsyncArgument</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Control</span> <span class="n">Host</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsCancelable</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Message</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">MessageHeight</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">MessageWidth</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">RunWorkerCompletedEventArgs</span><span class="p">&gt;</span> <span class="n">PostWorkCallBack</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ProgressChangedEventArgs</span><span class="p">&gt;</span> <span class="n">ProgressChanged</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">BackgroundWorker</span><span class="p">,</span> <span class="n">DoWorkEventArgs</span><span class="p">&gt;</span> <span class="n">Work</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can look into constructors and properties yourself, let me talk about callbacks available, which are Work, PostWorkCallback &amp; ProgressChanged.</p>

<ol>
  <li>
    <p><strong>Work</strong> : Here we do our main processing, it has 2 arguments BackgroundWorker &amp; DoWorkEventArgs.</p>
  </li>
  <li>
    <p><strong>PostWorkCalllBack</strong> : Once <strong>Work</strong> is completed, this is triggered to show output to user. This gets the results from <strong>RunWorkerCompletedEventArgs</strong> parameter, which is returned from  of <strong>Work</strong> callback.</p>
  </li>
  <li>
    <p><strong>ProgressChanged</strong> : If our process is long running, Unlike <em>Message = “Getting accounts”;</em> in GetAccounts(), we must show the progress to user. We can pass progress as integer in ProgressChangedEventArgs parameter.</p>
  </li>
</ol>

<p><strong>ExecuteMethod(Action action)</strong> helps to get rid of connection hurdles for plugin developer, all methods which require CRM connection should be called from ExecuteMethod which accepts Action as parameter. If CRM is not connected then it will show popup to connect before executing method.</p>

<h3 id="implementing--consuming-whoami">Implementing &amp; Consuming WhoAmI()</h3>

<p>Open MyPluginControl.cs[Design] and place a Button control in panel. change name property to btn_WhoAmI, optionally you can change other properties and decorate.</p>

<p><img src="assets/2018-06-08/Place_Button.png" alt="Placing button" /></p>

<p>Add one list box also with name lst_UserData below button to show current user’s data.</p>

<p><img src="assets/2018-06-08/ListBox.png" alt="ListBox" /></p>

<p>Double click on this button to create event and open code-behind file(MyPluginControl.cs) and write below code.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">btn_WhoAmI_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// calling WhoAmI() from ExecuteMethod so connection will be smooth</span>
    <span class="nf">ExecuteMethod</span><span class="p">(</span><span class="n">WhoAmI</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">WhoAmI</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">WorkAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">WorkAsyncInfo</span>
    <span class="p">{</span>
        <span class="c1">// Showing message until background work is completed</span>
        <span class="n">Message</span> <span class="p">=</span> <span class="s">"Retrieving WhoAmI Information"</span><span class="p">,</span>

        <span class="c1">// Main task which will be executed asynchronously</span>
        <span class="n">Work</span> <span class="p">=</span> <span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="c1">// making WhoAmIRequest</span>
            <span class="kt">var</span> <span class="n">whoAmIResponse</span> <span class="p">=</span> <span class="p">(</span><span class="n">WhoAmIResponse</span><span class="p">)</span><span class="n">Service</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="k">new</span> <span class="nf">WhoAmIRequest</span><span class="p">());</span>

            <span class="c1">// retrieving details of current user</span>
            <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="n">Service</span><span class="p">.</span><span class="nf">Retrieve</span><span class="p">(</span><span class="s">"systemuser"</span><span class="p">,</span> <span class="n">whoAmIResponse</span><span class="p">.</span><span class="n">UserId</span><span class="p">,</span> <span class="k">new</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Xrm</span><span class="p">.</span><span class="n">Sdk</span><span class="p">.</span><span class="n">Query</span><span class="p">.</span><span class="nf">ColumnSet</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>

            <span class="c1">// placing results to args, which will be sent to PostWorkCallBack to display to user</span>
            <span class="kt">var</span> <span class="n">userData</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">data</span> <span class="k">in</span> <span class="n">user</span><span class="p">.</span><span class="n">Attributes</span><span class="p">)</span>
                <span class="n">userData</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">data</span><span class="p">.</span><span class="n">Key</span><span class="p">}</span><span class="s"> : </span><span class="p">{</span><span class="n">data</span><span class="p">.</span><span class="n">Value</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">args</span><span class="p">.</span><span class="n">Result</span> <span class="p">=</span> <span class="n">userData</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="c1">// Work is completed, results can be shown to user</span>
        <span class="n">PostWorkCallBack</span> <span class="p">=</span> <span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Error</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="s">"Error"</span><span class="p">,</span> <span class="n">MessageBoxButtons</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="n">MessageBoxIcon</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="c1">// Binding result data to ListBox Control</span>
                <span class="n">lst_UserData</span><span class="p">.</span><span class="n">DataSource</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">Result</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Congratulations! You are done with your first XrmToolBox plugin now. Let’s test it now.</p>

<h3 id="test-your-plugin">Test Your Plugin</h3>

<p>Build your code and grab the DLL from bin/debug folder, and place it in %AppData%\MscrmTools\XrmToolBox\Plugins folder.
(You may refer to my previous article <a href="https://www.ashishvishwakarma.com/Installing-Using-XrmToolBox-Plugins-in-No-Internet-OnPremises-Environments/">Installing XrmToolBox Plugins in No Internet OnPremises Environments</a>).</p>

<p>Open XrmToolBox and search for your plugin, click to open it, when it asks to connect, click No, so you can verify ExcuteMethod functionality.</p>

<p><img src="assets/2018-06-08/OpenPlugin.png" alt="Open Plugin" /></p>

<p>Here is your brand new plugin, all created by yourself.
Click on <em>Who Am I</em> Button, it will ask to connect an organization first, because we have used <strong>ExecuteMethod()</strong> here.</p>

<p><img src="assets/2018-06-08/ClickWhoAmI.png" alt="ClickWhoAmI" /></p>

<p>Connect to an organization, after connecting to CRM, it will show the retrieving message which is set in our <strong>Message</strong> property is WhoAmI(). Finally it will show all information about current user in ListBox.</p>

<p><img src="assets/2018-06-08/WorkingPlugin.png" alt="PluginWorking" /></p>

<blockquote>
  <p>Get complete source code <a href="https://github.com/AshV/XrmToolBox.WhoAmIPlugin">here</a></p>
</blockquote>

<p>This DLL can be shared with anyone and they can use it. But to make it available to everyone you need to publish it, which I will discuss in next article.</p>

            <hr />
            <center><a href="https://www.buymeacoffee.com/AshV" target="_blank"><img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" alt="Buy Me A Coffee" style="height: auto !important;width: auto !important;"></a></center>
            <footer class="site-footer">
                <div id="disqus_thread"></div>
                <script>(function () { var d = document, s = d.createElement('script'); s.src = 'https://ashish-vishwakarma.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script>
                <span class="site-footer-credits">©<a href="https://www.ashishvishwakarma.com/">Ashish Vishwakarma</a>. | <a href="https://www.ashishvishwakarma.com/posts">Read More Posts</a></span>
            </footer>
        </article>
        <script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-88171590-1', 'auto'); ga('send', 'pageview');</script>
    </article>

            
            <footer class="site-footer">
                <!-- SVG icons from https://iconmonstr.com -->
                
                <!-- Github icon -->
                <span class="my-span-icon">
                    <a href="" aria-label="'s GitHub" title="'s GitHub">
                        <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    </a>
                </span>
                
                <!-- Twitter icon -->
                <span class="my-span-icon">
                    <a href="https://twitter.com/" aria-label="'s Twitter" title="'s Twitter">
                        <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
                    </a>
                </span>
                
                <!-- RSS icon -->
                
                
                <!-- Contact icon -->
                
                
                <span class="my-span-icon">
                    <a href="http://localhost:4000/contact.html" aria-label="Contact" title="Contact ">
                        <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
                    </a>
                </span>
                
                
            </footer>
        </section>
        
        <script>
            var menu = document.querySelector("nav.site-nav");
            var checkbox = document.getElementById("nav-trigger");
            
            // close menu if click outside menu
            document.addEventListener("click", function(e) {
                if (menu != e.target &&
                        !isDescendant(menu, e.target)) {
                    checkbox.checked = false;
                }
            }, false);
            
            function isDescendant(parent, child) {
                var node = child.parentNode;
                while (node != null) {
                    if (node == parent) {
                        return true;
                    }
                    node = node.parentNode;
                }
                return false;
            }  
        </script>
        
    </body>
    </html>
    